import streamlit as st
import pandas as pd
from datetime import datetime

# ==========================================
# 1. èœå–®è³‡æ–™åº« (è«‹åœ¨é€™è£¡æ–°å¢ä½ çš„åº—å®¶)
# ==========================================

# é€™è£¡æ˜¯ä¸€å€‹ã€Œå¤§å­—å…¸ã€ï¼Œæ ¼å¼æ˜¯ï¼š "åº—å®¶åç¨±": {"é£²æ–™å": åƒ¹æ ¼, ...}
ALL_MENUS = {
    "å¯ä¸å¯ç†Ÿæˆç´…èŒ¶": {
        "ç†Ÿæˆç´…èŒ¶": 30,
        "é´‰ç‰‡ç´…èŒ¶": 30,
        "å¤ªå¦ƒç´…èŒ¶": 35,
        "ç†Ÿæˆå†·éœ²": 30,
        "ç™½ç‰æ­è•¾": 50,
        "æ˜¥æ¢…å†°èŒ¶": 45
    },
    "50åµ": {
        "å››å­£æ˜¥é’èŒ¶": 30,
        "é»ƒé‡‘çƒé¾": 30,
        "çç å¥¶èŒ¶": 50,
        "æ³¢éœ¸å¥¶èŒ¶": 50,
        "ç´…èŒ¶æ‹¿éµ": 55,
        "8å†°ç¶ ": 50
    },
    "è¿·å®¢å¤": {
        "å¤§æ­£ç´…èŒ¶æ‹¿éµ": 60,
        "ä¼¯çˆµç´…èŒ¶æ‹¿éµ": 60,
        "çç ç´…èŒ¶æ‹¿éµ": 65,
        "æŸ³ä¸ç¶ èŒ¶": 60,
        "èŠ‹é ­é®®å¥¶": 65
    }
}

# ç”œåº¦å†°å¡Šé€šå¸¸æ˜¯é€šç”¨çš„ï¼Œè¨­å®šä¸€æ¬¡å°±å¥½
SUGAR_OPTS = ["æ­£å¸¸ç³–", "å°‘ç³– (8åˆ†)", "åŠç³– (5åˆ†)", "å¾®ç³– (3åˆ†)", "ä¸€åˆ†ç³–", "ç„¡ç³–"]
ICE_OPTS = ["æ­£å¸¸å†°", "å°‘å†°", "å¾®å†°", "å»å†°", "å¸¸æº«", "ç†±"]

# ==========================================
# 2. ç¶²é ä»‹é¢è¨­è¨ˆ
# ==========================================

st.title("ğŸ¥¤ è¾¦å…¬å®¤é£²æ–™é»é¤ç³»çµ±")

# --- å´é‚Šæ¬„ï¼šé¸æ“‡åº—å®¶ ---
st.sidebar.header("è¨­å®š")
selected_store = st.sidebar.selectbox("ä»Šå¤©å–å“ªä¸€å®¶ï¼Ÿ", list(ALL_MENUS.keys()))

# æ ¹æ“šå´é‚Šæ¬„çš„é¸æ“‡ï¼ŒæŠ“å–å°æ‡‰çš„èœå–®
current_menu = ALL_MENUS[selected_store]

st.subheader(f"ç›®å‰åº—å®¶ï¼š{selected_store}")

# --- ä¸»è¡¨å–®å€åŸŸ ---
with st.form("order_form"):
    col1, col2 = st.columns(2)
    with col1:
        name = st.text_input("ä½ çš„åå­— (å¿…å¡«)")
    with col2:
        # é€™è£¡çš„é¸é …æœƒæ ¹æ“šä¸Šé¢çš„ current_menu è‡ªå‹•è®Šæ›
        drink = st.selectbox("é£²æ–™å“é …", list(current_menu.keys()))
    
    col3, col4 = st.columns(2)
    with col3:
        sugar = st.selectbox("ç”œåº¦", SUGAR_OPTS)
    with col4:
        ice = st.selectbox("å†°å¡Š", ICE_OPTS)
        
    note = st.text_input("å‚™è¨» (ä¾‹å¦‚: åŠ çç +10å…ƒ)")

    submitted = st.form_submit_button("é€å‡ºè¨‚å–®")

    # ==========================================
    # 3. é€å‡ºå¾Œçš„è™•ç†
    # ==========================================
    if submitted:
        if not name:
            st.error("âŒ è«‹è¨˜å¾—è¼¸å…¥åå­—ï¼")
        else:
            price = current_menu[drink] # è‡ªå‹•æŸ¥åƒ¹
            order_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            
            # å»ºç«‹è³‡æ–™
            order_data = {
                "æ™‚é–“": order_time,
                "åº—å®¶": selected_store, # å¤šè¨˜ä¸€å€‹åº—å®¶æ¬„ä½
                "å§“å": name,
                "å“é …": drink,
                "åƒ¹æ ¼": price,
                "ç”œåº¦": sugar,
                "å†°å¡Š": ice,
                "å‚™è¨»": note
            }
            
            st.success(f"âœ… {name} é»é¤æˆåŠŸï¼")
            st.info(f"å…§å®¹ï¼š{drink} ({price}å…ƒ) / {sugar} / {ice}")
            
            # (é€™é‚Šä¸€æ¨£é ç•™çµ¦ä¹‹å¾Œæ¥ Google Sheets ç”¨)
            # print(order_data)
